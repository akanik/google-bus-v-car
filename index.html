<!DOCTYPE html>
<html>
<head>
    <title>Animated route</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
        html, body, #map {
            height: 100%;
            margin: 0px;
            padding: 0px
        }
        #map-overlay{
            position:absolute;
            top: 50px;
            left: 10px;
            padding:20px;
            background:rgba(255,255,255,.6);
        }
        input[type=text]{
            width:300px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="map-overlay">
        <form>
            Origin:
            <input type="text" id="origin" class="controls" placeholder="Search Box"><br>
            Destination:
            <input type="text" name="destination" id="destination"><br>
            <button id="routeCalc">Get Route</button>
        </form>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        var map, carIcon, busIcon, origin, destination;
        
        function initialize() {

            map = new google.maps.Map(document.getElementById("map"), {
              center: {lat:38.247907, lng:-85.759993},
              zoom: 11,
              mapTypeId: google.maps.MapTypeId.ROADMAP
            });
            
            carIcon = new google.maps.MarkerImage('http://maps.google.com/mapfiles/ms/micons/blue.png');
            busIcon = new google.maps.MarkerImage('http://maps.google.com/mapfiles/ms/micons/red.png');


            // Create the search box and link it to the UI element.
            origin = document.getElementById('origin');
            destination = document.getElementById('destination');
            
            var originSearchBox = new google.maps.places.SearchBox(origin);
            //map.controls[google.maps.ControlPosition.TOP_LEFT].push(origin);
            
            var destinationSearchBox = new google.maps.places.SearchBox(destination);
            //map.controls[google.maps.ControlPosition.TOP_LEFT].push(destination);
            
            // Bias the SearchBox results towards current map's viewport.
            map.addListener('bounds_changed', function() {
              originSearchBox.setBounds(map.getBounds());
              destinationSearchBox.setBounds(map.getBounds());
            });
            
            originSearchBox.addListener('places_changed', function() {
                var originPlaces = originSearchBox.getPlaces();
                var destinationPlaces = destinationSearchBox.getPlaces();
            });
            
            destinationSearchBox.addListener('places_changed', function() {
                var originPlaces = originSearchBox.getPlaces();
                var destinationPlaces = destinationSearchBox.getPlaces();
            });
                
        }
        
        //function drawDrivingRoute(coords, bounds){
        //    var i, route, marker;
        //                
        //    route = new google.maps.Polyline({
        //        path: [],
        //        geodesic: true,
        //        strokeColor: '#3B9EFA',
        //        strokeOpacity: 1.0,
        //        strokeWeight: 2,
        //        editable: false,
        //        map:map
        //    });
        //    
        //    marker = new google.maps.Marker({map:map, icon:carIcon});
        //    
        //    for(i = 0; i < coords.length; i++){
        //        setTimeout(function(coords){
        //            route.getPath().push(coords);
        //            marker.setPosition(coords);
        //        }, 100 * i, coords[i]);
        //    }
        //};
        //
        //function drawTransitRoute(coords, bounds){
        //    var i, route, marker;
        //    
        //    map.fitBounds(bounds);
        //    
        //    route = new google.maps.Polyline({
        //        path: [],
        //        geodesic: true,
        //        strokeColor: '#FA453B',
        //        strokeOpacity: 1.0,
        //        strokeWeight: 2,
        //        editable: false,
        //        map:map
        //    });
        //    
        //    marker = new google.maps.Marker({map:map, icon:busIcon});
        //    
        //    for(i = 0; i < coords.length; i++){
        //        setTimeout(function(coords){
        //            route.getPath().push(coords);
        //            marker.setPosition(coords);
        //        }, 100 * i, coords[i]);
        //    }
        //};
        
        function drawRoutes(carCoordinates, busCoordinates, carInterval, busInterval, busBounds){
            var ic, ib, carRoute, busRoute, carMarker, busMarker;
            
            map.fitBounds(busBounds);
            
            carRoute = new google.maps.Polyline({
                path: [],
                geodesic: true,
                strokeColor: '#3B9EFA',
                strokeOpacity: 1.0,
                strokeWeight: 2,
                editable: false,
                map:map
            });
            
            busRoute = new google.maps.Polyline({
                path: [],
                geodesic: true,
                strokeColor: '#FA453B',
                strokeOpacity: 1.0,
                strokeWeight: 2,
                editable: false,
                map:map
            });
            
            carMarker = new google.maps.Marker({map:map, icon:carIcon});
            busMarker = new google.maps.Marker({map:map, icon:busIcon});
            
            for(ic = 0; ic < carCoordinates.length; ic++){
                setTimeout(function(carCoordinates){
                    carRoute.getPath().push(carCoordinates);
                    carMarker.setPosition(carCoordinates);
                }, carInterval * ic, carCoordinates[ic]);
            }
            
            for(ib = 0; ib < busCoordinates.length; ib++){
                setTimeout(function(busCoordinates){
                    busRoute.getPath().push(busCoordinates);
                    busMarker.setPosition(busCoordinates);
                }, busInterval * ib, busCoordinates[ib]);
            }
        };
        
        function calculateRoute(start, end){
            
            var directionsService = new google.maps.DirectionsService();
            var directionsDisplay = new google.maps.DirectionsRenderer();
            
            var carRequest = {
                origin: start,
                destination: end,
                travelMode: 'DRIVING'
            };
            
            var busRequest = {
                origin: start,
                destination: end,
                travelMode: 'TRANSIT'
            };
            
            function carRoute(busBounds, busCoordinates, busDuration){
                var carCoordinates, carDuration, carCoorLen, busCoorLen, busToCarRatio, carCompletion, busCompletion, carInterval, busInterval;
                directionsService.route(carRequest, function(result, status) {
                    if (status == 'OK') {
                        directionsDisplay.setDirections(result);
                        
                        carCoordinates = result.routes[0].overview_path;
                        carDuration = result.routes[0].legs[0].duration['value'];
                        
                        carCoorLen = carCoordinates.length;
                        busCoorLen = busCoordinates.length;
                        
                        busToCarRatio = busDuration / carDuration;
                        
                        carCompletion = 10000; //in milliseconds
                        busCompletion = carCompletion * busToCarRatio;
                        
                        carInterval = carCompletion / carCoorLen;
                        busInterval = busCompletion / busCoorLen;
                        
                        console.log('busInterval', busInterval);
                        console.log('carInterval', carInterval);
                                                
                        drawRoutes(carCoordinates, busCoordinates, carInterval, busInterval, busBounds);
                    }
                });
            }
            
            function busRoute(){
                directionsService.route(busRequest, function(result, status) {
                    if (status == 'OK') {
                        directionsDisplay.setDirections(result);
                        
                        busBounds = result.routes[0].bounds;
                        busCoordinates = result.routes[0].overview_path;
                        busDuration = result.routes[0].legs[0].duration['value'];
                        
                        carRoute(busBounds, busCoordinates, busDuration);
                    }
                });
            }
            
            busRoute();
            
        };
        
        $('#routeCalc').click(function(event){
            var start = origin.value;
            var end = destination.value;
            
            calculateRoute(start, end);
            
            event.stopPropagation();
            return false;
        });
        
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?v=3.exp&amp;libraries=geometry,places&key=AIzaSyCYTUE0hvNPcioxBbCGMBwVNJzUjswdou0&callback=initialize"></script>
</body>
</html>